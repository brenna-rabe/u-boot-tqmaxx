// SPDX-License-Identifier: (GPL-2.0-or-later OR MIT)
/*
 * Common definitions for MBLS1028A and MBLS1028A-IND
 *
 * Copyright 2019-2020 TQ-Systems GmbH
 *
 * Authors: Michael Krummsdorf <michael.krummsdorf@tq-group.com>
 *          Matthias Schiffer <matthias.schiffer@tq-group.com>
 */

#include "fsl-ls1028a-tqmls1028a.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/net/ti-dp83867.h>

/ {
	aliases {
		serial0 = &serial0;
		serial1 = &serial1;
	};

	chosen {
		stdout-path = "serial0:115200n8";
	};

	soc {
		pcie@3500000 {
			status = "okay";
		};
	};

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		/* global autoconfigured region for contiguous allocations */
		linux,cma {
			compatible = "shared-dma-pool";
			reusable;
			/* 256 MiB */
			size = <0 0x10000000>;
			linux,cma-default;
		};
	};
};

&serial0 {
	status = "okay";
};

&serial1 {
	status = "okay";
};

&esdhc0 {
	cd-gpios = <&gpio0 31 GPIO_ACTIVE_LOW>;
	no-mmc;
	no-1-8-v;
	bus-width = <4>;
	status = "okay";
};

/* When switched to baseboard-internal i2c bus,
 * IIC5 has access to the following devices.
 */
&i2c4 {
	status = "okay";

	/* TI TUSB8041 */
	/* usbhub@44 */

	/* SI5338 - set up in U-Boot */
	/* clockgen@70 */
};

&i2c5 {
	status = "okay";

	gpio_exp_1v8: gpio-expander@70 {
		compatible = "nxp,pca9538";
		reg = <0x70>;
		gpio-controller;
		#gpio-cells = <2>;
		status = "okay";

		ec1_intn {
			gpio-hog;
			gpios = <0 0>;
			input;
			line-name = "EC1_INT#";
		};

		sgmii_intn {
			gpio-hog;
			gpios = <2 0>;
			input;
			line-name = "SGMII_INT#";
		};

		qsgmii_intn {
			gpio-hog;
			gpios = <4 0>;
			input;
			line-name = "QSGMII_INT#";
		};

		qsgmii_rstn {
			gpio-hog;
			gpios = <5 0>;
			output-high;
			line-name = "QSGMII_RESET#";
		};
	};
};

&mdio0 {
	status = "okay";

	mdio0_rgmii_phy00: ethernet-phy@0 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x00>;
		reset-names = "phy";
		reset-gpios = <&gpio_exp_1v8 1 GPIO_ACTIVE_LOW>;
		reset-assert-us = <1>;
		reset-deassert-us = <200>;
		ti,rx-internal-delay = <0x9>;
		ti,tx-internal-delay = <0x7>;
		ti,led-function = <0x05b0>;
		ti,led-ctrl = <0x1001>;
		ti,clk-output-sel = <DP83867_CLK_O_SEL_OFF>;
		ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
	};

	mdio0_sgmii_phy03: ethernet-phy@3 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x03>;
		reset-names = "phy";
		reset-gpios = <&gpio_exp_1v8 3 GPIO_ACTIVE_LOW>;
		/*
		 * Long reset to work around PHY incorrect strap pin sampling
		 * due to external capacitors for SGMII
		 */
		reset-assert-us = <2500>;
		reset-deassert-us = <200>;
		ti,led-function = <0x05b0>;
		ti,led-ctrl = <0x1001>;
		ti,clk-output-sel = <DP83867_CLK_O_SEL_OFF>;
		ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
	};

	qsgmii_phy1: ethernet-phy@1c {
		reg = <0x1c>;
	};

	qsgmii_phy2: ethernet-phy@1d {
		reg = <0x1d>;
	};

	qsgmii_phy3: ethernet-phy@1e {
		reg = <0x1e>;
	};

	qsgmii_phy4: ethernet-phy@1f {
		reg = <0x1f>;
	};
};

&enetc0 {
	phy-handle = <&mdio0_sgmii_phy03>;
	phy-mode = "sgmii";
	status = "okay";
};

&enetc1 {
	phy-handle = <&mdio0_rgmii_phy00>;
	phy-mode = "rgmii-id";
	status = "okay";
};

&ethsw_ports {
	port@0 {
		phy-handle = <&qsgmii_phy1>;
		phy-mode = "qsgmii";
		status = "okay";
	};

	port@1 {
		phy-handle = <&qsgmii_phy2>;
		phy-mode = "qsgmii";
		status = "okay";
	};

	port@2 {
		phy-handle = <&qsgmii_phy3>;
		phy-mode = "qsgmii";
		status = "okay";
	};

	port@3 {
		phy-handle = <&qsgmii_phy4>;
		phy-mode = "qsgmii";
		status = "okay";
	};
};

&sata {
	status = "okay";
};

&usb1 {
	dr_mode = "otg";
	status = "okay";
};

&usb2 {
	dr_mode = "host";
	status = "okay";
};
