# U-Boot for the TQ-Systems TQMa6ULx, TQMa6ULxL, TQMa6ULLx and TQMa6ULLxL modules

The main difference beween the form factors is the power supply concept. The
different module variants share the same hardware, use the same peripherals and
can be used on the same starter kit.

The following hardware revisions are supported:

Modules:

TQMa6ULx:	REV.030x
TQMa6ULLx:	REV.030x
TQMa6ULxL:	REV.020x
TQMa6ULLxL:	REV.020x

Mainboards:

MBa6ULx:	REV.020x

Hardware on modules TQMa6ULx, TQMa6ULxL, TQMa6ULLx and TQMa6ULLxL:

- e-MMC
- RTC (I2C)
- PMIC
- QSPI-NOR (optional)
- EEPROM
- Temperature sensor
- 256 / 512 MiB RAM

Supported hardware on Starterkit MBa6ULx:

- 2 Ethernet PHY connected to FEC0 / FEC1 (usage depends on CPU)
- SD-card slot
- UART
- USB

## Boot source

The following boot sources are supported:

- SD/eMMC
- QSPI-NOR

## Building

To build U-Boot for the TQ-Systems TQMa6UL[L]x[L] modules:

```
make <som>_[mem_]<baseboard>_<boot>_defconfig
make
```

som is a placeholder for the module base variant:
tqma6ulx	TQMa6ULx		i.MX6UL
tqma6ullx	TQMa6ULLx		i.MX6ULL
tqma6ulxl	TQMa6ULxL		i.MX6UL
tqma6ullxl	TQMa6ULLxL		i.MX6ULL

The mem config name component specifies the RAM configuration variant:

without mem	256 MiB (standard)
512mb		512 MiB

baseboard is a placeholder for the mainboard to compile for:
mba6ul		MBa6ULx

boot is a placeholder for the boot device:
mmc - SD/eMMC
qspi - QSPI-NOR

This gives the following configurations:

Plug modules on MBa6ULx

tqma6ulx_mba6ul_mmc_defconfig
tqma6ulx_mba6ul_qspi_defconfig

tqma6ulx_512mb_mba6ul_mmc_defconfig
tqma6ulx_512mb_mba6ul_qspi_defconfig

tqma6ullx_mba6ul_mmc_defconfig
tqma6ullx_mba6ul_qspi_defconfig

tqma6ullx_512mb_mba6ul_mmc_defconfig
tqma6ullx_512mb_mba6ul_qspi_defconfig

LGA modules with adapter on MBa6ULx

tqma6ulxl_mba6ul_mmc_defconfig
tqma6ulxl_mba6ul_qspi_defconfig

tqma6ullxl_mba6ul_mmc_defconfig
tqma6ullxl_mba6ul_qspi_defconfig

Note: LGA variants with 512 MiB are prepared but not tested

The default build artifact is named `u-boot-dtb.imx`. A binary with QSPI header
included (to be flashed onto QSPI-NOR at offset 0) can be built by passing
a filename with `.qspi` suffix to make:

```
make u-boot-dtb.imx.qspi
```

## USB gadget support

An example configuration tqma6ulx_mba6ul_mmc_fastboot_defconfig with the
following additions is provided:

### Fastboot gadget

The command `fastboot usb 0` is used to enable the fastboot gadget on the
Micro-B USB port (X9). The `fastboot` and `uuu` utilities can be used to erase
and flash SD/eMMC partitions, for example:

```
# Flash whole SD card (MMC device 1 partition 0)
#
# uuu with the -raw2sparse option is recommended to flash large images that
# have not been converted to sparse format beforehand
uuu FB: flash -raw2sparse 1:0 tq-image-weston-debug-tqma6ulx-mba6ulx.wic

# Erase first partition on eMMC (MMC device 0 partition 1)
fastboot erase 0:1
# or
uuu FB: erase 0:1
```

### USB Mass Storage gadget

Allows accessing the eMMC or SD card of the TQMa6UL[L]x[L] and MBa6ULx as a
USB storage device. Enable using `ums 0 mmc 0` (eMMC) or `ums 0 mmc 1` (SD
card).
